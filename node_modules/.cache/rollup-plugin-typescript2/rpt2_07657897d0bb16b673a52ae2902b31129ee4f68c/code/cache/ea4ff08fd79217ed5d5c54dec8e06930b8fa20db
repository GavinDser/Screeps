{"code":"/*\r\n* Module code goes here. Use 'module.exports' to export things:\r\n* module.exports.thing = 'a thing';\r\n*\r\n* You can import it from another modules like this:\r\n* var mod = require('Repairer');\r\n* mod.thing == 'a thing'; // true\r\n*/\r\n//import { Upgrader as upgrader } from \"./Upgrader\";\r\nexport const WallRepairer = {\r\n    /** @param {Creep} creep **/\r\n    run: function (creep) {\r\n        if (creep.memory.working && creep.store[RESOURCE_ENERGY] == 0) {\r\n            creep.memory.working = false;\r\n        }\r\n        if (!creep.memory.working && creep.store.getFreeCapacity() == 0) {\r\n            creep.memory.working = true;\r\n        }\r\n        if (creep.memory.working) {\r\n            var ramparts = creep.room.find(FIND_STRUCTURES, {\r\n                filter: (s) => s.structureType == STRUCTURE_RAMPART && (s.hits / s.hitsMax)\r\n            });\r\n            var findRampart = function () {\r\n                let rampart = _.sortBy(ramparts, (r) => (r.hits / r.hitsMax));\r\n                return rampart[0];\r\n            };\r\n            var newRampart = function () {\r\n                let rampart = ramparts.filter((r) => r.hits < 100);\r\n                return rampart;\r\n            };\r\n            if (ramparts.length) {\r\n                if (creep.memory.target == undefined || creep.memory.target.structureType != STRUCTURE_RAMPART) {\r\n                    if (newRampart().length) {\r\n                        creep.memory.target = newRampart()[0];\r\n                    }\r\n                    else {\r\n                        creep.memory.target = findRampart();\r\n                    }\r\n                }\r\n                else if (creep.memory.target != undefined && creep.memory.target.hits / creep.memory.target.hitsMax) {\r\n                    if (newRampart().length && creep.memory.target.id != newRampart()[0].id) {\r\n                        creep.memory.target = undefined;\r\n                    }\r\n                    if (creep.repair(creep.memory.target) == ERR_NOT_IN_RANGE) {\r\n                        creep.moveTo(creep.memory.target, { visualizePathStyle: { stroke: '#ffffff' } });\r\n                    }\r\n                }\r\n                else {\r\n                    creep.memory.target = undefined;\r\n                }\r\n            }\r\n            else {\r\n                var walls = creep.room.find(FIND_STRUCTURES, {\r\n                    filter: (s) => {\r\n                        return (s.structureType == STRUCTURE_WALL && s.hits / s.hitsMax);\r\n                    }\r\n                });\r\n                var findTarget = function () {\r\n                    let wall = _.sortBy(walls, (w) => w.hits / w.hitsMax);\r\n                    return wall[0];\r\n                };\r\n                if (creep.memory.target == undefined || creep.memory.target == undefined) {\r\n                    creep.memory.target = findTarget();\r\n                    if (!creep.memory.target) {\r\n                        //upgrader.run(creep)\r\n                    }\r\n                }\r\n                else if (creep.memory.target.hits / creep.memory.target.hitsMax < 0.05) {\r\n                    if (creep.repair(Game.getObjectById(creep.memory.target.id)) == ERR_NOT_IN_RANGE) {\r\n                        creep.moveTo(Game.getObjectById(creep.memory.target.id), { visualizePathStyle: { stroke: '#ffffff' } });\r\n                    }\r\n                }\r\n                else {\r\n                    creep.memory.target = undefined;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            // if (creep.withdraw(creep.room.storage,RESOURCE_ENERGY) == ERR_NOT_IN_RANGE){\r\n            //     creep.moveTo(creep.room.storage)\r\n            // }\r\n            //   if(creep.harvest(creep.pos.findClosestByRange(FIND_SOURCES_ACTIVE)) == ERR_NOT_IN_RANGE) {\r\n            //       creep.moveTo(creep.pos.findClosestByRange(FIND_SOURCES_ACTIVE), {visualizePathStyle: {stroke: '#ffaa00'}});\r\n            //   }\r\n            let sources = creep.room.find(FIND_STRUCTURES, {\r\n                filter: (s) => s.structureType == STRUCTURE_CONTAINER && s.store[RESOURCE_ENERGY] > 1500\r\n            });\r\n            let source = _.sortBy(sources, (s) => s.store[RESOURCE_ENERGY]).reverse();\r\n            if (source.length) {\r\n                if (creep.withdraw(source[0], RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {\r\n                    creep.moveTo(source[0]);\r\n                }\r\n            }\r\n            else {\r\n                if (creep.withdraw(creep.room.storage, RESOURCE_ENERGY) == ERR_NOT_IN_RANGE) {\r\n                    creep.moveTo(creep.room.storage);\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n//# sourceMappingURL=WallRepairer.js.map","references":[],"map":"{\"version\":3,\"file\":\"WallRepairer.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/modules/creep/WallRepairer.ts\"],\"names\":[],\"mappings\":\"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\"}"}
